<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gomoku Test Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        canvas {
            border: 2px solid #333;
            display: block;
            margin: 20px auto;
        }
        .test-results {
            list-style: none;
            padding: 0;
        }
        .test-results li {
            padding: 8px;
            margin: 5px 0;
            border-left: 4px solid #ccc;
            background: #f9f9f9;
        }
        .test-results li.pass {
            border-left-color: #28a745;
        }
        .test-results li.fail {
            border-left-color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="test-section">
        <h1>ğŸ® äº”å­æ£‹æ¸¸æˆä¿®å¤éªŒè¯</h1>
        <p>æµ‹è¯•é¡µé¢ç”¨äºéªŒè¯æ£‹ç›˜æ¸²æŸ“å’ŒåŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
    </div>

    <div class="test-section">
        <h2>åˆå§‹åŒ–æµ‹è¯•</h2>
        <div id="init-status" class="status info">æ­£åœ¨åˆå§‹åŒ–...</div>
        <ul id="test-results" class="test-results"></ul>
    </div>

    <div class="test-section">
        <h2>æ£‹ç›˜æ¸²æŸ“</h2>
        <canvas id="game-canvas"></canvas>
        <div id="canvas-info"></div>
    </div>

    <div class="test-section">
        <h2>æ¸¸æˆä¿¡æ¯</h2>
        <div style="padding: 10px; background: #f9f9f9; border-radius: 4px;">
            <div style="margin: 5px 0;">å½“å‰ç©å®¶: <span id="current-player">-</span></div>
            <div style="margin: 5px 0;">æ¸¸æˆæ¨¡å¼: <span id="game-mode">-</span></div>
            <div style="margin: 5px 0;">æ­¥æ•°: <span id="move-count">-</span></div>
            <div style="margin: 5px 0;">ç”¨æ—¶: <span id="game-time">-</span></div>
        </div>
        <div id="message" style="display:none;"></div>
    </div>

    <!-- Load modules -->
    <script src="js/utils/Logger.js"></script>
    <script src="js/utils/EventBus.js"></script>
    <script src="js/core/GameState.js"></script>
    <script src="js/core/RuleEngine.js"></script>
    <script src="js/core/CandidateGenerator.js"></script>
    <script src="js/core/EvaluationService.js"></script>
    <script src="js/core/AIEngine.js"></script>
    <script src="js/ui/CanvasRenderer.js"></script>
    <script src="js/ui/HudPanel.js"></script>

    <script>
        const results = document.getElementById('test-results');
        const initStatus = document.getElementById('init-status');
        const canvasInfo = document.getElementById('canvas-info');

        function addResult(message, passed) {
            const li = document.createElement('li');
            li.className = passed ? 'pass' : 'fail';
            li.textContent = (passed ? 'âœ“ ' : 'âœ— ') + message;
            results.appendChild(li);
            return passed;
        }

        function runTests() {
            let allPassed = true;

            try {
                // Test 1: Check modules loaded
                allPassed &= addResult('Logger æ¨¡å—å·²åŠ è½½', typeof Logger !== 'undefined');
                allPassed &= addResult('EventBus æ¨¡å—å·²åŠ è½½', typeof EventBus !== 'undefined');
                allPassed &= addResult('GameState æ¨¡å—å·²åŠ è½½', typeof GameState !== 'undefined');
                allPassed &= addResult('RuleEngine æ¨¡å—å·²åŠ è½½', typeof RuleEngine !== 'undefined');
                allPassed &= addResult('CanvasRenderer æ¨¡å—å·²åŠ è½½', typeof CanvasRenderer !== 'undefined');
                allPassed &= addResult('HudPanel æ¨¡å—å·²åŠ è½½', typeof HudPanel !== 'undefined');

                // Test 2: Create instances
                const gameState = new GameState();
                allPassed &= addResult('GameState å®ä¾‹åˆ›å»ºæˆåŠŸ', gameState !== null);

                const eventBus = new EventBus();
                allPassed &= addResult('EventBus å®ä¾‹åˆ›å»ºæˆåŠŸ', eventBus !== null);

                const ruleEngine = new RuleEngine(gameState);
                allPassed &= addResult('RuleEngine å®ä¾‹åˆ›å»ºæˆåŠŸ', ruleEngine !== null);

                const renderer = new CanvasRenderer('game-canvas', gameState, eventBus);
                allPassed &= addResult('CanvasRenderer å®ä¾‹åˆ›å»ºæˆåŠŸ', renderer !== null);

                const hudPanel = new HudPanel(gameState, eventBus);
                allPassed &= addResult('HudPanel å®ä¾‹åˆ›å»ºæˆåŠŸ', hudPanel !== null);

                // Test 3: Check canvas
                const canvas = document.getElementById('game-canvas');
                allPassed &= addResult('Canvas å…ƒç´ å­˜åœ¨', canvas !== null);
                allPassed &= addResult('Canvas å®½åº¦å·²è®¾ç½® (' + canvas.width + 'px)', canvas.width > 0);
                allPassed &= addResult('Canvas é«˜åº¦å·²è®¾ç½® (' + canvas.height + 'px)', canvas.height > 0);

                // Check if canvas has been drawn
                const ctx = canvas.getContext('2d');
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const hasPixels = imageData.data.some(v => v !== 0);
                allPassed &= addResult('Canvas å·²ç»˜åˆ¶å†…å®¹', hasPixels);

                canvasInfo.innerHTML = `
                    <div class="status ${hasPixels ? 'success' : 'error'}">
                        Canvas å°ºå¯¸: ${canvas.width} Ã— ${canvas.height} åƒç´ <br>
                        ${hasPixels ? 'âœ“ æ£‹ç›˜å·²æˆåŠŸæ¸²æŸ“ï¼' : 'âœ— æ£‹ç›˜æœªæ¸²æŸ“'}
                    </div>
                `;

                // Test 4: Check HUD updates
                const currentPlayerEl = document.getElementById('current-player');
                const gameModeEl = document.getElementById('game-mode');
                const moveCountEl = document.getElementById('move-count');

                allPassed &= addResult('å½“å‰ç©å®¶æ˜¾ç¤ºå·²æ›´æ–°', currentPlayerEl.textContent !== '-');
                allPassed &= addResult('æ­¥æ•°æ˜¾ç¤ºå·²æ›´æ–°', moveCountEl.textContent !== '-');

                // Update status
                if (allPassed) {
                    initStatus.className = 'status success';
                    initStatus.textContent = 'âœ“ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼æ£‹ç›˜å’ŒåŠŸèƒ½æ­£å¸¸å·¥ä½œã€‚';
                } else {
                    initStatus.className = 'status error';
                    initStatus.textContent = 'âœ— éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°ã€‚';
                }

            } catch (error) {
                initStatus.className = 'status error';
                initStatus.textContent = 'âœ— æµ‹è¯•å‡ºé”™: ' + error.message;
                addResult('å‘ç”Ÿå¼‚å¸¸: ' + error.message, false);
                console.error('Test error:', error);
            }
        }

        // Run tests after a short delay to ensure everything is loaded
        setTimeout(runTests, 100);
    </script>
</body>
</html>
